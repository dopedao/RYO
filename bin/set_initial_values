#!/bin/bash
set -eu

# Addresses come from running  '. bin/deploy'

get_address() {
    echo $(cat artifacts/deployed_addresses.json | jq -r --arg contract "$1" '.contracts[$contract].address')
}

# Save the ModuleController deployment address into the Arbiter.
add_controller_to_arbiter=$(starknet invoke \
    --network=alpha \
    --address $(get_address Arbiter) \
    --abi artifacts/abi/Arbiter_abi.json \
    --function set_address_of_controller \
    --inputs $(get_address ModuleController))
echo -e "\nController address saved into Arbter: \n${add_controller_to_arbiter}"

# Use the Arbiter to save module addresses into the ModuleController.
set_module_addr=$(starknet invoke \
    --network=alpha \
    --address $(get_address ModuleController) \
    --abi artifacts/abi/ModuleController_abi.json \
    --function set_initial_module_addresses \
    --inputs $(get_address 01_DopeWars) $(get_address 02_LocationOwned) \
    $(get_address 03_UserOwned) $(get_address 04_UserRegistry) \
    $(get_address 05_Combat) $(get_address 06_DrugLord) $(get_address 07_PseudoRandom))
echo -e "\nModule addresses 1-7 set: \n${set_module_addr}"
